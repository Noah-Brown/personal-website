---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);

function formatDate(date: Date) {
  const y = date.getFullYear();
  const m = String(date.getMonth() + 1).padStart(2, '0');
  const d = String(date.getDate()).padStart(2, '0');
  return `${y}.${m}.${d}`;
}
---

<BaseLayout
  title={`${post.data.title} â€” Noah Brown`}
  description={post.data.description}
  breadcrumb={`~<span class="text-border-bright mx-0.5">/</span>blog<span class="text-border-bright mx-0.5">/</span><span class="text-accent">${post.id}</span>`}
  breadcrumbMeta={formatDate(post.data.date)}
  activeTab="home"
>
  <article class="max-w-[72ch]">
    <header class="mb-10">
      <h1 class="font-display text-[28px] font-bold text-heading leading-[1.2] mb-3" set:html={
        post.data.title.replace(/Worth It/i, '<span class="text-accent">Worth It</span><span class="inline-block w-[2px] h-[1.1em] bg-accent align-middle ml-1 animate-[blink_1s_step-end_infinite]"></span>')
      } />
      <div class="font-mono text-[12px] text-text-muted mb-4">
        {formatDate(post.data.date)}
      </div>
      {post.data.tags.length > 0 && (
        <div class="flex gap-2">
          {post.data.tags.map((tag) => (
            <span class="font-mono text-[10px] px-2 py-0.5 border border-border rounded-sm text-text-dim">
              {tag}
            </span>
          ))}
        </div>
      )}
    </header>

    <div class="prose prose-invert max-w-none
                prose-headings:font-display prose-headings:text-heading prose-headings:font-bold
                prose-h2:text-[28px] prose-h3:text-[20px]
                prose-p:font-body prose-p:text-[15px] prose-p:text-text prose-p:leading-[1.8]
                prose-li:font-body prose-li:text-text
                prose-strong:text-heading
                prose-a:text-accent prose-a:no-underline hover:prose-a:underline
                prose-code:font-mono prose-code:text-accent prose-code:text-[13px]
                prose-pre:bg-surface prose-pre:border prose-pre:border-border prose-pre:font-mono
                prose-img:rounded prose-img:border prose-img:border-border">
      <Content />
    </div>
  </article>
</BaseLayout>
