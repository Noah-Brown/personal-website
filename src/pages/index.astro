---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog'))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 5);

function formatDate(date: Date) {
  const y = date.getFullYear();
  const m = String(date.getMonth() + 1).padStart(2, '0');
  const d = String(date.getDate()).padStart(2, '0');
  return `${y}.${m}.${d}`;
}

function readTime(body: string | undefined) {
  if (!body) return '1 min';
  const words = body.trim().split(/\s+/).length;
  return `${Math.max(1, Math.ceil(words / 230))} min`;
}
---

<BaseLayout
  title="Noah Brown"
  breadcrumb={`~<span class="text-border-bright mx-0.5">/</span>blog<span class="text-border-bright mx-0.5">/</span><span class="text-accent">all-posts</span>`}
  breadcrumbMeta={`${posts.length} entries`}
  activeTab="home"
>
  {/* Hero */}
  <div class="mb-8 pb-6 border-b border-border">
    <div class="font-mono text-[12px] text-accent mb-2 flex items-center gap-2">
      $ whoami <span class="inline-block w-[7px] h-[14px] bg-accent animate-[blink_1s_step-end_infinite]"></span>
    </div>
    <h1 class="font-display text-[clamp(28px,3.5vw,38px)] font-bold text-heading leading-[1.2] mb-3">
      Hey, I'm Noah.
    </h1>
    <p class="text-[14px] text-text-dim max-w-[55ch] leading-[1.7]">
      IT engineer building infrastructure, automating the boring stuff, and playing golf. I write about Ansible, Linux, firewalls, and the occasional AI experiment.
    </p>
  </div>

  {/* Post list header */}
  <div class="grid grid-cols-[90px_1fr_110px_80px] gap-4 px-3 py-2 font-mono text-[10px] tracking-[0.12em] uppercase text-text-muted border-b border-border-bright mb-1 max-md:grid-cols-[70px_1fr] max-md:[&>:nth-child(3)]:hidden max-md:[&>:nth-child(4)]:hidden">
    <div>date</div>
    <div>title</div>
    <div>topic</div>
    <div class="text-right">read</div>
  </div>

  {/* Post rows */}
  {posts.map((post) => (
    <a href={`/blog/${post.id}/`} class="grid grid-cols-[90px_1fr_110px_80px] gap-4 p-3 border-b border-border no-underline rounded-sm transition-all hover:bg-accent-glow hover:border-transparent hover:shadow-[inset_2px_0_0_var(--color-accent)] items-baseline max-md:grid-cols-[70px_1fr] max-md:[&>:nth-child(3)]:hidden max-md:[&>:nth-child(4)]:hidden">
      <div class="font-mono text-[12px] text-text-muted">{formatDate(post.data.date)}</div>
      <div class="flex flex-col gap-0.5">
        <div class="font-body text-[14px] text-heading font-medium">{post.data.title}</div>
        {post.data.description && (
          <div class="text-[12px] text-text-dim leading-[1.5]">{post.data.description}</div>
        )}
      </div>
      <div class="font-mono text-[11px] text-text-dim">
        {post.data.tags[0] && <><span class="text-magenta">#</span>{post.data.tags[0]}</>}
      </div>
      <div class="font-mono text-[11px] text-text-muted text-right">{readTime(post.body)}</div>
    </a>
  ))}
</BaseLayout>
